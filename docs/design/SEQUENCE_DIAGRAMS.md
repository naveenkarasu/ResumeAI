# Sequence Diagrams - Rust/Go Backend

## 1. Chat Request Flow

```
┌──────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌───────┐   ┌─────┐
│Client│   │  Go API    │   │Rust ML Svc │   │   Qdrant   │   │  LLM  │   │ DB  │
└──┬───┘   └─────┬──────┘   └─────┬──────┘   └─────┬──────┘   └───┬───┘   └──┬──┘
   │             │                │                │              │          │
   │ POST /chat  │                │                │              │          │
   │────────────>│                │                │              │          │
   │             │                │                │              │          │
   │             │ gRPC: Search   │                │              │          │
   │             │───────────────>│                │              │          │
   │             │                │                │              │          │
   │             │                │  Embed Query   │              │          │
   │             │                │───────────────>│              │          │
   │             │                │<───────────────│              │          │
   │             │                │                │              │          │
   │             │                │  BM25 Search   │              │          │
   │             │                │ (internal)     │              │          │
   │             │                │                │              │          │
   │             │                │  Vector Search │              │          │
   │             │                │───────────────>│              │          │
   │             │                │<───────────────│              │          │
   │             │                │                │              │          │
   │             │                │  RRF Fusion    │              │          │
   │             │                │ (internal)     │              │          │
   │             │                │                │              │          │
   │             │ gRPC: Rerank   │                │              │          │
   │             │───────────────>│                │              │          │
   │             │                │                │              │          │
   │             │                │ Cross-Encoder  │              │          │
   │             │                │ (internal)     │              │          │
   │             │<───────────────│                │              │          │
   │             │                │                │              │          │
   │             │ HTTP: Generate │                │              │          │
   │             │────────────────────────────────────────────────>          │
   │             │<────────────────────────────────────────────────          │
   │             │                │                │              │          │
   │             │ Save message   │                │              │          │
   │             │─────────────────────────────────────────────────────────>│
   │             │<─────────────────────────────────────────────────────────│
   │             │                │                │              │          │
   │ Response    │                │                │              │          │
   │<────────────│                │                │              │          │
   │             │                │                │              │          │
```

## 2. Job Search Flow

```
┌──────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌───────┐
│Client│   │  Go API    │   │Rust ML Svc │   │   Qdrant   │   │  DB   │
└──┬───┘   └─────┬──────┘   └─────┬──────┘   └─────┬──────┘   └───┬───┘
   │             │                │                │              │
   │ POST /search│                │                │              │
   │────────────>│                │                │              │
   │             │                │                │              │
   │             │ Check Cache    │                │              │
   │             │────────────────────────────────────────────────>│
   │             │<────────────────────────────────────────────────│
   │             │                │                │              │
   │             │ [Cache Miss]   │                │              │
   │             │                │                │              │
   │             │ Parse NL Query │                │              │
   │             │────────────────────────────────────────────────>│ (LLM)
   │             │<────────────────────────────────────────────────│
   │             │                │                │              │
   │             │ gRPC: Search   │                │              │
   │             │───────────────>│                │              │
   │             │                │                │              │
   │             │                │ Hybrid Search  │              │
   │             │                │───────────────>│              │
   │             │                │<───────────────│              │
   │             │<───────────────│                │              │
   │             │                │                │              │
   │             │ Get Job Details│                │              │
   │             │────────────────────────────────────────────────>│
   │             │<────────────────────────────────────────────────│
   │             │                │                │              │
   │             │ gRPC: ExtractSkills (for match) │              │
   │             │───────────────>│                │              │
   │             │<───────────────│                │              │
   │             │                │                │              │
   │             │ Calculate Match Scores          │              │
   │             │ (internal)     │                │              │
   │             │                │                │              │
   │             │ Cache Results  │                │              │
   │             │────────────────────────────────────────────────>│
   │             │                │                │              │
   │ Response    │                │                │              │
   │<────────────│                │                │              │
```

## 3. Scraping Flow

```
┌──────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌───────┐
│Client│   │  Go API    │   │ Go Scraper │   │Rust ML Svc │   │  DB   │
└──┬───┘   └─────┬──────┘   └─────┬──────┘   └─────┬──────┘   └───┬───┘
   │             │                │                │              │
   │ POST /scrape│                │                │              │
   │────────────>│                │                │              │
   │             │                │                │              │
   │             │ Create Task    │                │              │
   │             │────────────────────────────────────────────────>│
   │             │<────────────────────────────────────────────────│
   │             │                │                │              │
   │ Task ID     │                │                │              │
   │<────────────│                │                │              │
   │             │                │                │              │
   │             │ Queue Task     │                │              │
   │             │───────────────>│                │              │
   │             │                │                │              │
   │             │                │ For each source:              │
   │             │                │                │              │
   │             │                │ Launch Browser │              │
   │             │                │ (chromedp)     │              │
   │             │                │                │              │
   │             │                │ Scrape Jobs    │              │
   │             │                │ (rate limited) │              │
   │             │                │                │              │
   │             │                │ Deduplicate    │              │
   │             │                │────────────────────────────────>│
   │             │                │<────────────────────────────────│
   │             │                │                │              │
   │             │                │ gRPC: Embed    │              │
   │             │                │───────────────>│              │
   │             │                │<───────────────│              │
   │             │                │                │              │
   │             │                │ Store in Qdrant│              │
   │             │                │───────────────>│(via ML svc)  │
   │             │                │<───────────────│              │
   │             │                │                │              │
   │             │                │ Save to DB     │              │
   │             │                │────────────────────────────────>│
   │             │                │                │              │
   │             │                │ Update Task    │              │
   │             │                │────────────────────────────────>│
   │             │                │                │              │
   │             │                │                │              │
   │ GET /status │                │                │              │
   │────────────>│                │                │              │
   │             │ Get Status     │                │              │
   │             │────────────────────────────────────────────────>│
   │ Status      │<────────────────────────────────────────────────│
   │<────────────│                │                │              │
```

## 4. Resume Indexing Flow

```
┌──────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐
│Client│   │  Go API    │   │Rust ML Svc │   │   Qdrant   │
└──┬───┘   └─────┬──────┘   └─────┬──────┘   └─────┬──────┘
   │             │                │                │
   │ POST /resume│                │                │
   │ (upload)    │                │                │
   │────────────>│                │                │
   │             │                │                │
   │             │ Parse Resume   │                │
   │             │ (internal)     │                │
   │             │                │                │
   │             │ gRPC: ExtractSkills             │
   │             │───────────────>│                │
   │             │<───────────────│                │
   │             │                │                │
   │             │ Chunk Text     │                │
   │             │ (internal)     │                │
   │             │                │                │
   │             │ gRPC: EmbedBatch                │
   │             │───────────────>│                │
   │             │                │                │
   │             │                │ ONNX Inference │
   │             │                │ (internal)     │
   │             │<───────────────│                │
   │             │                │                │
   │             │ gRPC: IndexDocuments            │
   │             │───────────────>│                │
   │             │                │                │
   │             │                │ Upsert Vectors │
   │             │                │───────────────>│
   │             │                │<───────────────│
   │             │                │                │
   │             │                │ Build BM25 Idx │
   │             │                │ (internal)     │
   │             │<───────────────│                │
   │             │                │                │
   │ Success     │                │                │
   │<────────────│                │                │
```

## Component Interaction Summary

```
┌─────────────────────────────────────────────────────────────────┐
│                        Request Flow                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Client ──HTTP──> Go API ──gRPC──> Rust ML ──────> Qdrant       │
│                     │                 │                          │
│                     │                 │                          │
│                     ▼                 ▼                          │
│                 PostgreSQL        ONNX Models                    │
│                     │                                            │
│                     │                                            │
│                     ▼                                            │
│                 External LLMs (Groq, OpenAI, Claude)            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

Communication Protocols:
- Client ↔ Go API: HTTP/REST (JSON)
- Go API ↔ Rust ML: gRPC (Protobuf)
- Go API ↔ PostgreSQL: SQL (pgx driver)
- Rust ML ↔ Qdrant: gRPC (native client)
- Go API ↔ LLMs: HTTP (provider SDKs)
```
